# Tor Relay Configuration
# Copy this file to relay.toml and customize

[relay]
# Relay nickname (1-19 alphanumeric characters)
# Choose something memorable and unique
nickname = "MyTorRelay"

# Operating mode: "middle", "exit", or "bridge"
# - middle: Safest, just forwards encrypted traffic
# - exit: Connects to internet on behalf of users (higher risk)
# - bridge: Unlisted entry point for censored users
mode = "middle"

# OR (Onion Router) port - main relay port
# Standard is 9001, but any port works
or_port = 9001

# Directory port (0 to disable)
# Set to 9030 to serve directory information
dir_port = 0

# Contact information (recommended)
# Include email and optionally GPG fingerprint
contact = "admin@example.com"

# Address to advertise (leave empty for auto-detection)
# Set this if your relay is behind NAT
address = ""

# Address to bind to
bind_address = "0.0.0.0"

[relay.bandwidth]
# Rate limit in bytes per second (0 = unlimited)
# 10485760 = 10 MB/s = 80 Mbps
rate = 10485760

# Burst limit in bytes
# Should be >= rate, allows temporary spikes
burst = 20971520

# Advertised bandwidth (for directory)
# Set lower than actual to leave headroom
advertised = 10485760

# ─────────────────────────────────────────────────────────────
# EXIT RELAY CONFIGURATION
# Only used when mode = "exit"
# ─────────────────────────────────────────────────────────────

[exit]
# Exit policy - controls which destinations exit relay can reach
# Rules evaluated in order, first match wins
# Format: "accept|reject address:port"
#
# WARNING: Running an exit relay means traffic to destinations
# appears to come from your IP. Configure carefully!

exit_policy = """
# Allow common web ports
accept *:80
accept *:443

# Allow secure email
accept *:587
accept *:993
accept *:995

# Allow SSH (use with caution)
# accept *:22

# Reject everything else
reject *:*
"""

# Alternative: Use built-in reduced exit policy
# This allows ~65 common ports considered "safe"
reduced_exit_policy = false

# Always reject private/internal addresses
# Keep this true unless you know what you're doing
reject_private = true

# ─────────────────────────────────────────────────────────────
# BRIDGE RELAY CONFIGURATION
# Only used when mode = "bridge"
# ─────────────────────────────────────────────────────────────

[bridge]
# How bridge address is distributed to users
# Options: "https", "email", "moat", "none"
distribution = "https"

# Pluggable transport (optional, for obfuscation)
[bridge.transport]
enabled = false
type = "obfs4"
bind_address = "0.0.0.0:9002"

# ─────────────────────────────────────────────────────────────
# DIRECTORY SETTINGS
# ─────────────────────────────────────────────────────────────

[directory]
# Publish server descriptor to directory authorities
# Set false for bridges (they use bridge authority)
publish_server_descriptor = true

# Fetch directory updates
fetch_directory = true

# Act as directory cache (serve directory to others)
# Requires dir_port to be set
directory_cache = false

# How often to fetch new consensus (seconds)
fetch_interval = 3600

# ─────────────────────────────────────────────────────────────
# LOGGING
# ─────────────────────────────────────────────────────────────

[logging]
# Log level: "trace", "debug", "info", "warn", "error"
level = "info"

# Log to file (empty = stdout only)
# Useful for Docker: leave empty, use docker logs
file = ""

# Log rotation settings (when file is set)
max_size_mb = 100
max_files = 5

# ─────────────────────────────────────────────────────────────
# DATA STORAGE
# ─────────────────────────────────────────────────────────────

[data]
# Data directory for keys, state, cached data
# Docker: Use /var/lib/tor (mounted volume)
directory = "/var/lib/tor"

# Key file paths (relative to data directory)
identity_key = "keys/ed25519_identity"
onion_key = "keys/curve25519_onion"

# ─────────────────────────────────────────────────────────────
# NETWORK SETTINGS
# ─────────────────────────────────────────────────────────────

[network]
# Connection timeout (seconds)
connect_timeout = 30

# Idle connection timeout (seconds)
idle_timeout = 600

# Maximum concurrent connections
max_connections = 8192

# TCP keepalive interval (seconds)
keepalive_interval = 30

# ─────────────────────────────────────────────────────────────
# SECURITY SETTINGS
# ─────────────────────────────────────────────────────────────

[security]
# Use secure memory for cryptographic keys
# Locks keys in RAM, prevents swapping
secure_memory = true

# Enable seccomp sandbox (Linux only)
# Restricts system calls for security
sandbox = false

# ─────────────────────────────────────────────────────────────
# METRICS (Optional)
# ─────────────────────────────────────────────────────────────

[metrics]
# Enable Prometheus metrics endpoint
enabled = false

# Metrics port
port = 9090

# Metrics path
path = "/metrics"
